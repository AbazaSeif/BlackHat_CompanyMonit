<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>BOB: net/i2p/BOB/UDPIOthread.java Source File</title>
<link href="BOB:%20net_i2p_BOB_UDPIOthread.java%20Source%20File_files/doxygen.css" rel="stylesheet" type="text/css">
<link href="BOB:%20net_i2p_BOB_UDPIOthread.java%20Source%20File_files/tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="http://echelon.i2p.xyz/docs/BOB-doc/main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="http://echelon.i2p.xyz/docs/BOB-doc/namespaces.html"><span>Packages</span></a></li>
      <li><a href="http://echelon.i2p.xyz/docs/BOB-doc/annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="http://echelon.i2p.xyz/docs/BOB-doc/files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>net/i2p/BOB/UDPIOthread.java</h1><a href="http://echelon.i2p.xyz/docs/BOB-doc/UDPIOthread_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00024"></a>00024 <span class="keyword">package </span>net.i2p.xyz.BOB;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">import</span> java.io.DataInputStream;
<a name="l00027"></a>00027 <span class="keyword">import</span> java.io.DataOutputStream;
<a name="l00028"></a>00028 <span class="keyword">import</span> java.io.IOException;
<a name="l00029"></a>00029 <span class="keyword">import</span> java.net.Socket;
<a name="l00030"></a>00030 <span class="keyword">import</span> net.i2p.xyz.client.I2PSession;
<a name="l00031"></a>00031 <span class="keyword">import</span> net.i2p.xyz.client.I2PSessionException;
<a name="l00032"></a>00032 <span class="keyword">import</span> net.i2p.xyz.client.I2PSessionListener;
<a name="l00033"></a>00033 <span class="keyword">import</span> net.i2p.xyz.data.Destination;
<a name="l00034"></a>00034 <span class="keyword">import</span> net.i2p.xyz.util.Log;
<a name="l00035"></a>00035 
<a name="l00046"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html">00046</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html">UDPIOthread</a> <span class="keyword">implements</span> I2PSessionListener, Runnable {
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#3f9f3af05ed6746b92e1f1a3db52382f">00048</a>         <span class="keyword">private</span> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1NamedDB.html">NamedDB</a> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#3f9f3af05ed6746b92e1f1a3db52382f">info</a>;
<a name="l00049"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">00049</a>         <span class="keyword">private</span> Log <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">_log</a>;
<a name="l00050"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#144b5540f470645c0c4f811ebdce467f">00050</a>         <span class="keyword">private</span> Socket <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#144b5540f470645c0c4f811ebdce467f">socket</a>;
<a name="l00051"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7097d0bb80691a300eb237a53b5fbf53">00051</a>         <span class="keyword">private</span> DataInputStream <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7097d0bb80691a300eb237a53b5fbf53">in</a>;
<a name="l00052"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#d6457e2ff61416c9affb80dd35731f0d">00052</a>         <span class="keyword">private</span> DataOutputStream <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#d6457e2ff61416c9affb80dd35731f0d">out</a>;
<a name="l00053"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7efca40ffaa5cdf1d38d5b3d3eaed0c0">00053</a>         <span class="keyword">private</span> I2PSession <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7efca40ffaa5cdf1d38d5b3d3eaed0c0">_session</a>;
<a name="l00054"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#4da37e2c9a1f492d5f27655fe8362fb5">00054</a>         <span class="keyword">private</span> Destination <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#4da37e2c9a1f492d5f27655fe8362fb5">_peerDestination</a>;
<a name="l00055"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#f1b54e9e3692499711f94b24e1caa53d">00055</a>         <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#f1b54e9e3692499711f94b24e1caa53d">up</a>;
<a name="l00056"></a>00056 
<a name="l00064"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#d7c351e3a0df105b5b878d4d0ed603a3">00064</a>         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#d7c351e3a0df105b5b878d4d0ed603a3">UDPIOthread</a>(<a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1NamedDB.html">NamedDB</a> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#3f9f3af05ed6746b92e1f1a3db52382f">info</a>, Log <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">_log</a>, Socket <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#144b5540f470645c0c4f811ebdce467f">socket</a>, I2PSession <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7efca40ffaa5cdf1d38d5b3d3eaed0c0">_session</a>) {
<a name="l00065"></a>00065                 this.info = info;
<a name="l00066"></a>00066                 this._log = _log;
<a name="l00067"></a>00067                 this.socket = socket;
<a name="l00068"></a>00068                 this._session = _session;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 
<a name="l00075"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#e40870254a3da6e07e652d65d31a5dce">00075</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#e40870254a3da6e07e652d65d31a5dce">run</a>() {
<a name="l00076"></a>00076                 byte data[] = <span class="keyword">new</span> byte[1024];
<a name="l00077"></a>00077                 <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#f1b54e9e3692499711f94b24e1caa53d">up</a> = <span class="keyword">true</span>;
<a name="l00078"></a>00078                 <span class="keywordflow">try</span> {
<a name="l00079"></a>00079                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7097d0bb80691a300eb237a53b5fbf53">in</a> = <span class="keyword">new</span> DataInputStream(<a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#144b5540f470645c0c4f811ebdce467f">socket</a>.getInputStream());
<a name="l00080"></a>00080                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#d6457e2ff61416c9affb80dd35731f0d">out</a> = <span class="keyword">new</span> DataOutputStream(<a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#144b5540f470645c0c4f811ebdce467f">socket</a>.getOutputStream());
<a name="l00081"></a>00081                         <span class="keywordflow">while</span> (<a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#f1b54e9e3692499711f94b24e1caa53d">up</a>) {
<a name="l00082"></a>00082                                 <span class="keywordtype">int</span> c = <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7097d0bb80691a300eb237a53b5fbf53">in</a>.read(data);
<a name="l00083"></a>00083                                 <span class="comment">// Note: could do a loopback test here with a wrapper.</span>
<a name="l00084"></a>00084                                 <span class="keywordtype">boolean</span> ok = <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7efca40ffaa5cdf1d38d5b3d3eaed0c0">_session</a>.sendMessage(<a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#4da37e2c9a1f492d5f27655fe8362fb5">_peerDestination</a>, data, 0, c);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086                                 <span class="keywordflow">if</span> (!ok) {
<a name="l00087"></a>00087                                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#f1b54e9e3692499711f94b24e1caa53d">up</a> = <span class="keyword">false</span>; <span class="comment">// Is this the right thing to do??</span>
<a name="l00088"></a>00088                                 }
<a name="l00089"></a>00089                         }
<a name="l00090"></a>00090                 } <span class="keywordflow">catch</span> (IOException ioe) {
<a name="l00091"></a>00091                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">_log</a>.error(<span class="stringliteral">"Error running"</span>, ioe);
<a name="l00092"></a>00092                 } <span class="keywordflow">catch</span> (I2PSessionException ise) {
<a name="l00093"></a>00093                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">_log</a>.error(<span class="stringliteral">"Error communicating"</span>, ise);
<a name="l00094"></a>00094                 <span class="comment">//              } catch(DataFormatException dfe) {</span>
<a name="l00095"></a>00095                 <span class="comment">//                      _log.error("Peer destination file is not valid", dfe);</span>
<a name="l00096"></a>00096                 } <span class="keywordflow">finally</span> {
<a name="l00097"></a>00097                         <span class="keywordflow">if</span> (<a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7efca40ffaa5cdf1d38d5b3d3eaed0c0">_session</a> != null) {
<a name="l00098"></a>00098                                 <span class="keywordflow">try</span> {
<a name="l00099"></a>00099                                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#7efca40ffaa5cdf1d38d5b3d3eaed0c0">_session</a>.destroySession();
<a name="l00100"></a>00100                                 } <span class="keywordflow">catch</span> (I2PSessionException ise) {
<a name="l00101"></a>00101                                         <span class="comment">// ignored</span>
<a name="l00102"></a>00102                                 }
<a name="l00103"></a>00103                         }
<a name="l00104"></a>00104                 }
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106 
<a name="l00113"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#6602e43c49133737839cc3caad91bec2">00113</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#6602e43c49133737839cc3caad91bec2">messageAvailable</a>(I2PSession session, <span class="keywordtype">int</span> msgId, <span class="keywordtype">long</span> size) {
<a name="l00114"></a>00114 <span class="comment">//              _log.debug("Message available: id = " + msgId + " size = " + size);</span>
<a name="l00115"></a>00115                 <span class="keywordflow">try</span> {
<a name="l00116"></a>00116                         byte msg[] = session.receiveMessage(msgId);
<a name="l00117"></a>00117                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#d6457e2ff61416c9affb80dd35731f0d">out</a>.write(msg);
<a name="l00118"></a>00118                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#d6457e2ff61416c9affb80dd35731f0d">out</a>.flush();
<a name="l00119"></a>00119                 } <span class="keywordflow">catch</span> (I2PSessionException ise) {
<a name="l00120"></a>00120                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#f1b54e9e3692499711f94b24e1caa53d">up</a> = <span class="keyword">false</span>;
<a name="l00121"></a>00121                 } <span class="keywordflow">catch</span> (IOException ioe) {
<a name="l00122"></a>00122                         <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#f1b54e9e3692499711f94b24e1caa53d">up</a> = <span class="keyword">false</span>;
<a name="l00123"></a>00123                 }
<a name="l00124"></a>00124         }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <span class="comment">// Great, can these be used to kill ourselves.</span>
<a name="l00128"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#1e005ad37f7a83554ac8758aab108b31">00128</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#1e005ad37f7a83554ac8758aab108b31">disconnected</a>(I2PSession session) {
<a name="l00129"></a>00129                 <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">_log</a>.debug(<span class="stringliteral">"Disconnected"</span>);
<a name="l00130"></a>00130         <span class="comment">// up = false;</span>
<a name="l00131"></a>00131         }
<a name="l00132"></a>00132 
<a name="l00134"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5d9a9153e4084bd64675626c03447bd0">00134</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5d9a9153e4084bd64675626c03447bd0">errorOccurred</a>(I2PSession session, String message, Throwable error) {
<a name="l00135"></a>00135                 <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">_log</a>.debug(<span class="stringliteral">"Error occurred: "</span> + message, error);
<a name="l00136"></a>00136         <span class="comment">// up = false;</span>
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138 
<a name="l00140"></a><a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#2515bd653d1731d4db051eddaf710826">00140</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#2515bd653d1731d4db051eddaf710826">reportAbuse</a>(I2PSession session, <span class="keywordtype">int</span> severity) {
<a name="l00141"></a>00141                 <a class="code" href="http://echelon.i2p.xyz/docs/BOB-doc/classnet_1_1i2p_1_1BOB_1_1UDPIOthread.html#5f5ea028fb61253803537b7182bd8c96">_log</a>.debug(<span class="stringliteral">"Abuse reported of severity "</span> + severity);
<a name="l00142"></a>00142         <span class="comment">// up = false;</span>
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Jan 9 23:04:43 2010 for BOB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="BOB:%20net_i2p_BOB_UDPIOthread.java%20Source%20File_files/doxygen.png" alt="doxygen" border="0" align="middle"></a> 1.5.6 </small></address>


</body></html>